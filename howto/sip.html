
<!DOCTYPE HTML>
<html lang="">
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Configure SIP</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-toggle-chapters/toggle.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-bandwidth-fonts/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-bandwidth-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-theme-bandwidth/theme-api.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../styles/website.css">
        
    
        
    
        
    
        
    
        
    
        
    

        
    <script type="text/javascript">
        setTimeout(function(){var a=document.createElement("script");
        var b=document.getElementsByTagName("script")[0];
        a.src=document.location.protocol+"//script.crazyegg.com/pages/scripts/0029/8291.js?"+Math.floor(new Date().getTime()/3600000);
        a.async=true;a.type="text/javascript";b.parentNode.insertBefore(a,b)}, 1);
    </script>
    
    
    
    <meta name="HandheldFriendly" content="true">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="webrtc.html">
    
    
    <link rel="prev" href="acrobits.html">
    


    </head>
    <body>
        
    <noscript>
        <iframe src="//www.googletagmanager.com/ns.html?id=GTM-P2JT7Z" height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>
    <script>
        (function(w,d,s,l,i){
            w[l]=w[l]||[];
            w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
            var f=d.getElementsByTagName(s)[0],
                j=d.createElement(s),
                dl=l!='dataLayer'?'&l='+l:'';
            j.async=true;
            j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;
            f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-P2JT7Z');
    </script>
    
    
<div class="book"><link href="../styles/styles.min.css" type="text/css">
<div class="head">
     <!-- <div id="banner">
       <div class="bannerContainer">
        <img src="../images/dev-week-logo.png" />
         <p>&nbsp;&nbsp;&nbsp;&nbsp;Bandwidth loves Developer Week! Check out our limited viewing of the Evolution of SMS & Messaging Webinar. <a href="http://bandwidth.com/developerweek" target="_blank">WATCH IT NOW >></a></p>
         <p id="bannerClose">X</p>
       </div>
     </div> -->
   <a href="http://www.bandwidth.com" class="aimg"><div id="headerLogo"></div></a>
   <h2> &#x203A;&#xA0; Docs for Developers</h2>
   <ul>
   	<li><a href="https://catapult.inetwork.com/portal/signup" target="_blank" style="border-bottom: 0px;"><button class="medium hover-go right">Sign up</button></a></li>
   	<li><a href="https://catapult.inetwork.com/pages/login.jsf" target="_blank">Log in</a></li>
   	<li><a href="https://support.bandwidth.com/access/unauthenticated" target="_blank">Support</a></li>
   </ul>
</div>

    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search">
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Overview</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Home
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2">
            
                <a target="_blank" href="http://www.bandwidth.com/pricing/">
            
                    
                    Pricing
            
                &#xA0;<i class="icons8-open-in-window" style="float:right;"></i></a>
            

            
        </li>
    

    
        
        <li class="header">How To</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../getStarted.html">
            
                <a href="../getStarted.html">
            
                    
                    Get Started
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="buytn.html">
            
                <a href="buytn.html">
            
                    
                    Get a Number
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="incomingCallandMessaging.html">
            
                <a href="incomingCallandMessaging.html">
            
                    
                    Receive Messages and Calls
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="sendSMSMMS.html">
            
                <a href="sendSMSMMS.html">
            
                    
                    Send SMS/MMS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="smsDLR.html">
            
                <a href="smsDLR.html">
            
                    
                    Send SMS with Delivery Receipt
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="outboundCall.html">
            
                <a href="outboundCall.html">
            
                    
                    Create outbound call
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.7" data-path="importDashboard.html">
            
                <a href="importDashboard.html">
            
                    
                    Import Dashboard Numbers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.8" data-path="messagingHub.html">
            
                <a href="messagingHub.html">
            
                    
                    Messaging Hub Getting Started
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.9" data-path="acrobits.html">
            
                <a href="acrobits.html">
            
                    
                    For Mobile Apps
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="2.10" data-path="sip.html">
            
                <a href="sip.html">
            
                    
                    Configure SIP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.11" data-path="webrtc.html">
            
                <a href="webrtc.html">
            
                    
                    WebRTC
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Security</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../security.html">
            
                <a href="../security.html">
            
                    
                    Access Bandwidth App Platform API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../callbackSecurity.html">
            
                <a href="../callbackSecurity.html">
            
                    
                    Secure your callbacks
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">API Reference</li>
        
        
    
        <li class="chapter " data-level="4.1">
            
                <a href="http://dev.bandwidth.com/ap-docs/methods/restApi.html">
            
                    
                    Full API reference
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Deployable Demos</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="deployableDemos.html">
            
                <a href="deployableDemos.html">
            
                    
                    All Languages
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">SDKs</li>
        
        
    
        <li class="chapter " data-level="6.1" data-path="../clientLib/node.html">
            
                <a href="../clientLib/node.html">
            
                    
                    Node JS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="../clientLib/csharp.html">
            
                <a href="../clientLib/csharp.html">
            
                    
                    C-Sharp
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.3" data-path="../clientLib/ruby.html">
            
                <a href="../clientLib/ruby.html">
            
                    
                    Ruby
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.4" data-path="../clientLib/python.html">
            
                <a href="../clientLib/python.html">
            
                    
                    Python
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.5" data-path="../clientLib/java.html">
            
                <a href="../clientLib/java.html">
            
                    
                    Java
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Help</li>
        
        
    
        <li class="chapter " data-level="7.1">
            
                <a target="_blank" href="http://dev.bandwidth.com/faq">
            
                    
                    FAQ
            
                &#xA0;<i class="icons8-open-in-window" style="float:right;"></i></a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="..">Configure SIP</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section" style="padding-top: 0px;">
                                
                                <div class="api-method"><div class="api-method-definition"><div class="api-definition-top"></div></div><div class="api-method-code mm-code-first" style="min-height: 0vh;"><div class="api-code-top mm-code-top"></div></div></div>

<h1 id="sip-clients--registering-sip-endpoints">SIP Clients &amp; Registering SIP Endpoints</h1>
<p>This guide shows how to get started with SIP endpoints for SIP Phones, Mobile Clients, Web Clients and IP Phones.</p>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>Create an <a href="incomingCallandMessaging.html"><code>/applications</code></a> resource; set your <code>incomingCallUrl</code> to your server with <code>{&quot;autoAnswer&quot;:false}</code></li>
<li>Configure an incoming phone number associated with your application - in this example, +1555444333 is the Bandwidth phone number on your account.</li>
<li>Your account is enabled for domains. Contact us to enable your account.</li>
</ul>
<h2 id="overview">Overview</h2>
<p>Bandwidth SIP endpoints allow you to register end-user SIP phone devices directly to the App Platform and extend the ability to manage call control to SIP devices such as mobile clients and IP phones.</p>
<p>In this tutorial, you will learn how to:</p>
<ol>
<li>Create a unique SIP domain for your service to use (LIMIT: each account can have a max. 100 domains)</li>
<li>Create an endpoint/user. You&apos;ll associate the endpoint both with your domain and with an application for incoming SIP calls</li>
<li>Make a phone call to your endpoint/user</li>
<li>Receive an incoming call from your SIP endpoint. You&apos;ll then bridge the call to the Public Switched Telephone Network (PSTN)
5.Receive incoming phone calls from the PSTN. You&apos;ll then bridge the call to a SIP endpoint</li>
</ol>
<div class="api-method"><div class="api-method-definition"><div class="api-definition-top"></div><h2 id="step-1---create-a-unique-domain-for-your-service-to-use">Step 1 - Create a unique domain for your service to use</h2>
<p>A domain is a way to logically group endpoints.  The name of the domain will be part of a public DNS record.  For that reason, we let the customer choose their domain names.  Once a domain has been created, endpoints can be created and managed within the context of the domain.  Because endpoints can only exist within the context of a domain, creating a domain is the first step in creating endpoints.</p>
<p><code class="post">POST</code><code>/v1/users/{user-id}/domains</code></p>
</div><div class="api-method-code mm-method-code"><div class="api-method-example"><h3 id="create-domain">Create Domain</h3>
</div><div class="api-method-sample" data-lang="http" data-name="HTTP"><pre><code class="lang-json">{
  <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;xyz-corp-testing&quot;</span>,
  <span class="hljs-attr">&quot;description&quot;</span>: <span class="hljs-string">&quot;Testing Demo Domain&quot;</span>
}
</code></pre>
<pre><code>HTTP/1.1 201 Created
Location: /v1/users/{user-id}/domains/{domain-id}
</code></pre></div></div></div>


<div class="api-method"><div class="api-method-definition"><div class="api-definition-top"></div><h2 id="step-2---create-an-endpointuser">Step 2 - Create an endpoint/user</h2>
<p>An endpoint represents an entity that can register with the Bandwidth App Platform Registrar and place and receive calls.  An endpoint is addressable using a unique SIP URI which is constructed using the endpoint&apos;s user name and the domain in which the endpoint exists.</p>
<blockquote>
<p>E.g. <strong>user1234@xyz-corp-testing.bwapp.bwsip.io</strong></p>
</blockquote>
<p>There are no restrictions on the number of SIP clients that can be associated with an endpoint.  That is, an application can create one endpoint in the Bandwidth App Platform and give the SIP URI and credentials to as many of their own clients as it likes.  However, when a call is made to the SIP URI for that endpoint, all clients registered as that endpoint (using that SIP URI and credentials to register) will receive the call.  The call will be completed to the first client that answers.</p>
<p>If you don&apos;t want all your SIP clients to ring simultaneously, create an endpoint for each client.  You can still associate a single phone number with a group of clients, but the application has more control over which client will ring when that number is called.</p>
<blockquote>
<p>NOTE: You must associate an &#x201C;application-id&#x201D; with your endpoint to receive events from your endpoint. See the <a href="http://dev.bandwidth.com/ap-docs/extendmethods/applications/applications.html" target="_blank"><code>/applications</code></a> resource for how to create an application id.</p>
</blockquote>
<p><code class="post">POST</code><code>/v1/users/{user-id}/domains/{domain-id}/endpoints</code></p>
</div><div class="api-method-code mm-method-code"><div class="api-method-example"><h3 id="create-endpointuser">Create endpoint/user</h3>
</div><div class="api-method-sample" data-lang="http" data-name="HTTP"><pre><code class="lang-json">{
    <span class="hljs-attr">&quot;name&quot;</span> : <span class="hljs-string">&quot;jsmith_mobile&quot;</span>,
    <span class="hljs-attr">&quot;description&quot;</span> : <span class="hljs-string">&quot;John Smiths mobile client&quot;</span>,
    <span class="hljs-attr">&quot;domainId&quot;</span> : <span class="hljs-string">&quot;{domain-id}&quot;</span>,
    <span class="hljs-attr">&quot;applicationId&quot;</span> : <span class="hljs-string">&quot;{application-id}&quot;</span>,
    <span class="hljs-attr">&quot;enabled&quot;</span> : <span class="hljs-string">&quot;true&quot;</span>,
    <span class="hljs-attr">&quot;credentials&quot;</span> : { <span class="hljs-attr">&quot;password&quot;</span> : <span class="hljs-string">&quot;abc123&quot;</span> }
}
</code></pre>
<pre><code>HTTP/1.1 201 Created
Location: /v1/users/{user-id}/domains/{domain-id}/endpoints/{endpoint-id}
</code></pre></div></div></div>


<div class="api-method"><div class="api-method-definition"><div class="api-definition-top"></div><h2 id="step-3---register-sip-client--softphone">Step 3 - Register SIP Client / Softphone</h2>
<p>For testing purposes, download a SIP client like <a href="http://yateclient.yate.ro" target="_blank">yate</a> and setup your username, password and realm, you can retrieve your endpoints as follows.</p>
<p><code class="get">GET</code><code>/v1/users/{user-id}/domains/{domain-id}/endpoints</code></p>
</div><div class="api-method-code mm-method-code"><div class="api-method-example"><h3 id="fetch-registration-information">Fetch Registration information</h3>
</div><div class="api-method-sample" data-lang="http" data-name="HTTP"><pre><code class="lang-json">200 OK
Content-Type: application/json
[
  {
    &quot;id&quot;: &quot;re-6dd6kudwpxo3672peoycsgq&quot;,
    &quot;name&quot;: &quot;jsmith_mobile&quot;,
    &quot;domainId&quot;: &quot;rd-3kfl2yi4ja6npquwxpnpqji&quot;,
    &quot;enabled&quot;: true,
    &quot;applicationId&quot;: &quot;a-qjbpfmrr46qf2lklgc72tvy&quot;,
    &quot;sipUri&quot;: &quot;sip:jsmith_mobile@xyz-corp-testing.bwapp.bwsip.io&quot;,
    &quot;credentials&quot;: {
      &quot;realm&quot;: &quot;xyz-corp-testing.bwapp.bwsip.io&quot;,
      &quot;username&quot;: &quot;jsmith_mobile &quot;
    }
  }
]
</code></pre>
</div></div></div>


<p>Be sure your SIP client is registered on the network, in Yate Client for example, you will see an &#x201C;online&#x201D; status.</p>
<p><img src="images/sip/YateClient.png" alt="Yate"></p>
<hr>

<h2 id="step-4-create-a-new-outbound-call">Step 4: Create a New Outbound Call</h2>
<p>Next, make a call to your SIP client using the App Platform APIs. The flow for this is shown here:</p>
<p><img src="images/sip/SIP-Clients-2.png" alt="SIP-Clients-2.png"></p>
<p>The API calls for each sequence in this flow is described below:</p>
<div class="api-method"><div class="api-method-definition"><div class="api-definition-top"></div><h3 id="1-create-a-new-outbound-call">1: Create a New Outbound Call</h3>
<p>Create a New Outbound Call to Your SIP Endpoint. You can start a new outbound call to your SIP endpoint, <strong>be sure to set the callbackUrl so you can detect the &#x2018;answer&#x2019; event for the next step.</strong></p>
<p><code class="post">POST</code><code>v1/users/{user-id}/calls</code></p>
</div><div class="api-method-code mm-method-code"><div class="api-method-example"><h3 id="create-a-new-outbound-call">Create a New Outbound Call</h3>
</div><div class="api-method-sample" data-lang="http" data-name="HTTP"><pre><code class="lang-json">{
&#x2002; <span class="hljs-attr">&quot;from&quot;</span>: <span class="hljs-string">&quot;+1555444333&quot;</span>,
&#x2002; <span class="hljs-attr">&quot;to&quot;</span>: <span class="hljs-string">&quot;sip:jsmith_mobile@xyz-corp-testing.bwapp.bwsip.io&quot;</span>,
  <span class="hljs-attr">&quot;callbackUrl&quot;</span> : <span class="hljs-string">&quot;http://yourserver.com&quot;</span>
}
</code></pre>
<pre><code>HTTP/1.1 201 Created
Location: /v1/users/{userId}/calls/{callId}
</code></pre></div></div></div>

<div class="api-method"><div class="api-method-definition"><div class="api-definition-top"></div><h3 id="2-receive-answer-event">2: Receive Answer event</h3>
<p>Outbound call - receive an <a href="http://dev.bandwidth.com/ap-docs/apiCallbacks/answer.html" target="_blank"><code>answer</code></a> event from Bandwidth. When the SIP client answers the call, Bandwidth will POST to your callback URL the <code>answer</code> event that you will use to say something to the caller.</p>
<p><code class="post">POST</code><code>http://yourwebserver.com</code></p>
</div><div class="api-method-code mm-method-code"><div class="api-method-example"><h3 id="receive-answer-event">Receive Answer event</h3>
</div><div class="api-method-sample" data-lang="http" data-name="HTTP"><pre><code class="lang-json">{
   <span class="hljs-attr">&quot;callState&quot;</span>:<span class="hljs-string">&quot;active&quot;</span>,
   <span class="hljs-attr">&quot;from&quot;</span>:<span class="hljs-string">&quot;+1555444333&quot;</span>,
   <span class="hljs-attr">&quot;time&quot;</span>:<span class="hljs-string">&quot;2014-06-13T22:37:05Z&quot;</span>,
   <span class="hljs-attr">&quot;to&quot;</span>:<span class="hljs-string">&quot;sip:jsmith_mobile@xyz-corp-testing.bwapp.bwsip.io&quot;</span>,
   <span class="hljs-attr">&quot;eventType&quot;</span>:<span class="hljs-string">&quot;answer&quot;</span>,
   <span class="hljs-attr">&quot;callId&quot;</span>:<span class="hljs-string">&quot;c-m6dz5lqurhhxnn7is6v3w4y&quot;</span>,
   <span class="hljs-attr">&quot;callUri&quot;</span>: <span class="hljs-string">&quot;https://api.catapult.inetwork.com/v1/users/{user-id} /calls/{call-id}&quot;</span>
}
</code></pre>
</div></div></div>

<div class="api-method"><div class="api-method-definition"><div class="api-definition-top"></div><h3 id="3-speak-sentence">3: Speak Sentence</h3>
<p>Use the <a href="http://dev.bandwidth.com/ap-docs/extendmethods/calls/postCallsCallIdAudio.html" target="_blank">speak sentence</a> to speak &#x201C;Hello SIP Client&#x201D;. 
<code class="post">POST</code><code>v1/users/{user-id}/calls/{call-id}/audio</code></p>
</div><div class="api-method-code mm-method-code"><div class="api-method-example"><h3 id="speak-sentence">Speak Sentence</h3>
</div><div class="api-method-sample" data-lang="http" data-name="HTTP"><pre><code class="lang-json">{
  <span class="hljs-attr">&quot;gender&quot;</span>: <span class="hljs-string">&quot;female&quot;</span>,
  <span class="hljs-attr">&quot;voice&quot;</span>: <span class="hljs-string">&quot;kate&quot;</span>,
  <span class="hljs-attr">&quot;sentence&quot;</span>: <span class="hljs-string">&quot;Hello sip client&quot;</span>,
  <span class="hljs-attr">&quot;locale&quot;</span>: <span class="hljs-string">&quot;en_US&quot;</span>
}
</code></pre>
<pre><code>200 OK
</code></pre></div></div></div>

<div class="api-method"><div class="api-method-definition"><div class="api-definition-top"></div><h3 id="4-receive-speak-event">4: Receive Speak Event</h3>
<p>Detect when &#x201C;speaking&#x201D; is done. To know when speaking completes, you will receive a <a href="http://dev.bandwidth.com/ap-docs/apiCallbacks/speak.html" target="_blank">callback</a> <code>{&quot;eventType&quot;: &quot;speak&quot;, &quot;status&quot;: &quot;done&quot;}</code>.</p>
<p><code class="post">POST</code><code>http://yourwebserver.com</code></p>
</div><div class="api-method-code mm-method-code"><div class="api-method-example"><h3 id="receive-speak-event">Receive Speak Event</h3>
</div><div class="api-method-sample" data-lang="http" data-name="HTTP"><pre><code class="lang-json">{
   <span class="hljs-attr">&quot;time&quot;</span>:<span class="hljs-string">&quot;2014-06-17T01:14:30Z&quot;</span>,
   <span class="hljs-attr">&quot;eventType&quot;</span>:<span class="hljs-string">&quot;speak&quot;</span>,
   <span class="hljs-attr">&quot;status&quot;</span>:<span class="hljs-string">&quot;done&quot;</span>,
   <span class="hljs-attr">&quot;state&quot;</span>:<span class="hljs-string">&quot;PLAYBACK_STOP&quot;</span>,
   <span class="hljs-attr">&quot;callId&quot;</span>:<span class="hljs-string">&quot;c-m6dz5lqurhhxnn7is6v3w4y&quot;</span>,
   <span class="hljs-attr">&quot;callUri&quot;</span>: <span class="hljs-string">&quot;https://api.catapult.inetwork.com/v1/users/{user-id{/calls/{call-id}&quot;</span>
}
</code></pre>
</div></div></div>

<div class="api-method"><div class="api-method-definition"><div class="api-definition-top"></div><h3 id="5-hang-up-the-call">5: Hang-up the call</h3>
<p>After the text to speech completes, you can simply <a href="http://dev.bandwidth.com/ap-docs/extendmethods/calls/postCallsCallId.html" target="_blank">hangup</a>.  </p>
<p><code class="post">POST</code><code>/v1/users/{user-id}/calls/{call-id}</code></p>
</div><div class="api-method-code mm-method-code"><div class="api-method-example"><h3 id="hang-up-the-call">Hang-up the call</h3>
</div><div class="api-method-sample" data-lang="http" data-name="HTTP"><pre><code class="lang-json">{
   <span class="hljs-attr">&quot;state&quot;</span>: <span class="hljs-string">&quot;completed&quot;</span>
}
</code></pre>
<pre><code>200 OK
</code></pre></div></div></div>

<h2 id="step-5---receive-an-incoming-call-from-your-sip-endpoint">Step 5 - Receive an incoming call from your SIP endpoint</h2>
<p>When a SIP client makes a call, you will receive an &#x201C;<a title="Incoming Call Event" href="http://ap.bandwidth.com/docs/callback-events/voice-calls/incoming-call-event/" target="_blank">incomingcall</a>&#x201D; event from that SIP client, you can choose what to do. In most basic use case, you will simply want to start an outbound call to the PSTN and bridge the calls together. The flow for this is shown here:</p>
<p><img src="images/sip/SIP-Clients-Endpoints-Incoming1.png" alt="SIP-Clients-Endpoints-Incoming1.png"></p>
<p>The API calls for each sequence in this flow is described below:</p>
<div class="api-method"><div class="api-method-definition"><div class="api-definition-top"></div><h3 id="step-1-receive-an-incoming-call-event">Step 1: Receive an Incoming Call Event</h3>
<p><strong>Receive an Incoming Call Event from your SIP Endpoint</strong>. Note that your application is set for autoAnswer = false so the call will ring until you answer it in sequence 4 below.</p>
<p><code class="post">POST</code><code>http://yourwebserver.com</code></p>
</div><div class="api-method-code mm-method-code"><div class="api-method-example"><h3 id="receive-an-incoming-call-event">Receive an Incoming Call Event</h3>
</div><div class="api-method-sample" data-lang="http" data-name="HTTP"><pre><code class="lang-json">{
   <span class="hljs-attr">&quot;callState&quot;</span>:<span class="hljs-string">&quot;active&quot;</span>,
   <span class="hljs-attr">&quot;to&quot;</span>:<span class="hljs-string">&quot;+15552223333&quot;</span>,
   <span class="hljs-attr">&quot;time&quot;</span>:<span class="hljs-string">&quot;2014-06-13T22:37:05Z&quot;</span>,
   <span class="hljs-attr">&quot;from&quot;</span>:<span class="hljs-string">&quot;sip:jsmith_mobile@xyz-corp-testing.bwapp.bwsip.io&quot;</span>,
   <span class="hljs-attr">&quot;eventType&quot;</span>:<span class="hljs-string">&quot;incomingcall&quot;</span>,
   <span class="hljs-attr">&quot;callId&quot;</span>:<span class="hljs-string">&quot;c-m6dz5lqurhhxnn7is6v3w4y&quot;</span>,
   <span class="hljs-attr">&quot;callUri&quot;</span>: <span class="hljs-string">&quot;https://api.catapult.inetwork.com/v1/users/{user-id} /calls/{call-id}&quot;</span>
}
</code></pre>
</div></div></div>

<div class="api-method"><div class="api-method-definition"><div class="api-definition-top"></div><h3 id="step-2-create-a-new-outbound-call-to-the-pstn">Step 2: Create a New Outbound Call to the PSTN.</h3>
<p><strong>Create a New Outbound Call to the PSTN.</strong> You can start a new outbound call to your SIP endpoint, <strong>be sure to set the callbackUrl so you can detect the &#x2018;answer&#x2019; event for the next step.</strong></p>
<p><code class="post">POST</code><code>/v1/users/{user-id}/calls</code></p>
</div><div class="api-method-code mm-method-code"><div class="api-method-example"><h3 id="create-a-new-outbound-call-to-the-pstn">Create a New Outbound Call to the PSTN.</h3>
</div><div class="api-method-sample" data-lang="http" data-name="HTTP"><pre><code class="lang-json">{
&#x2002; <span class="hljs-attr">&quot;from&quot;</span>: <span class="hljs-string">&quot;+1555444333&quot;</span>,
&#x2002; <span class="hljs-attr">&quot;to&quot;</span>: <span class="hljs-string">&quot;+15552223333&quot;</span>,
  <span class="hljs-attr">&quot;callbackUrl&quot;</span> : <span class="hljs-string">&quot;http://yourserver.com&quot;</span>
}
</code></pre>
<pre><code>HTTP/1.1 201 Created
Location: /v1/users/{userId}/calls/{callId}
</code></pre></div></div></div>

<div class="api-method"><div class="api-method-definition"><div class="api-definition-top"></div><h3 id="step-3-receive-an-answer-event-from-bandwidth">Step 3: Receive an &#x2018;answer&#x2019; event from Bandwidth</h3>
<p><strong>Outbound call - receive an &#x2018;answer&#x2019; event from Bandwidth.</strong> When the PSTN call answers the call, Bandwidth will POST to your callback URL the <a href="http://dev.bandwidth.com/ap-docs/apiCallbacks/answer.html" target="_blank"><code>answer</code></a> event that you will use to trigger answering the SIP client call leg and bridging the calls together.</p>
<p><code class="post">POST</code><code>http://yourwebserver.com</code></p>
</div><div class="api-method-code mm-method-code"><div class="api-method-example"><h3 id="receive-an-answer-event-from-bandwidth">Receive an &#x2018;answer&#x2019; event from Bandwidth</h3>
</div><div class="api-method-sample" data-lang="http" data-name="HTTP"><pre><code class="lang-json">{
   <span class="hljs-attr">&quot;callState&quot;</span>:<span class="hljs-string">&quot;active&quot;</span>,
&#x2002;  <span class="hljs-attr">&quot;from&quot;</span>: <span class="hljs-string">&quot;+1555444333&quot;</span>,
&#x2002;  <span class="hljs-attr">&quot;to&quot;</span>: <span class="hljs-string">&quot;+15552223333&quot;</span>,
   <span class="hljs-attr">&quot;time&quot;</span>:<span class="hljs-string">&quot;2014-06-13T22:37:05Z&quot;</span>,
   <span class="hljs-attr">&quot;eventType&quot;</span>:<span class="hljs-string">&quot;answer&quot;</span>,
   <span class="hljs-attr">&quot;callId&quot;</span>:<span class="hljs-string">&quot;c-m6dz5lqurhhxnn7is6v3w4y&quot;</span>,
   <span class="hljs-attr">&quot;callUri&quot;</span>: <span class="hljs-string">&quot;https://api.catapult.inetwork.com/v1/users/{user-id} /calls/{call-id}&quot;</span>
}
</code></pre>
</div><div class="api-method-example"><p><strong>Answer the call.</strong></p>
</div><div class="api-method-sample" data-lang="http" data-name="HTTP"><p><code class="post">POST</code>/v1/users/{user-id}/calls/{call-id}</p>
<pre><code class="lang-json">{
   <span class="hljs-attr">&quot;state&quot;</span>: <span class="hljs-string">&quot;active&quot;</span>
}
</code></pre>
<pre><code>200 OK
</code></pre></div><div class="api-method-example"><p><strong>Bridge calls together.</strong></p>
</div><div class="api-method-sample" data-lang="http" data-name="HTTP"><p><code class="post">POST</code>/v1/users/{userId}/bridges</p>
<pre><code class="lang-json">{
  <span class="hljs-attr">&quot;callIds&quot;</span>:  [<span class="hljs-string">&quot;{callId1}&quot;</span>,<span class="hljs-string">&quot;{callId2}&quot;</span>]
}
</code></pre>
<pre><code>HTTP/1.1 201 Created
Location: /v1/users/{userId}/calls/{bridgeId}
</code></pre></div></div></div>

<h2 id="step-6---receive-incoming-phone-calls-from-the-pstn">Step 6 - Receive incoming phone calls from the PSTN</h2>
<p>In this step you&apos;ll receive the incoming call from the PSTN and bridge it to your SIP endpoint. The flow for this is shown here:</p>
<p><img src="images/sip/SIP-Clients-Endpoints-Incoming.png" alt="SIP-Clients-Endpoints-Incoming.png"></p>
<p>The API calls for each sequence in this flow is described below:</p>
<div class="api-method"><div class="api-method-definition"><div class="api-definition-top"></div><h3 id="step-1-receive-an-incoming-call-event-from-pstn">Step 1: Receive an Incoming Call Event from PSTN</h3>
<p><strong>Receive an Incoming Call Event from PSTN</strong>. Note that your application is set for autoAnswer = false so the call will ring until you answer it in sequence 4 below.</p>
<p><code class="post">POST</code><code>http://yourwebserver.com</code></p>
</div><div class="api-method-code mm-method-code"><div class="api-method-example"><h3 id="receive-an-incoming-call-event-from-pstn">Receive an Incoming Call Event from PSTN</h3>
</div><div class="api-method-sample" data-lang="http" data-name="HTTP"><pre><code class="lang-json">{
   <span class="hljs-attr">&quot;callState&quot;</span>:<span class="hljs-string">&quot;active&quot;</span>,
   <span class="hljs-attr">&quot;from&quot;</span>:<span class="hljs-string">&quot;+12223334444&quot;</span>,
   <span class="hljs-attr">&quot;time&quot;</span>:<span class="hljs-string">&quot;2014-06-13T22:37:05Z&quot;</span>,
   <span class="hljs-attr">&quot;to&quot;</span>:<span class="hljs-string">&quot;+1555444333&quot;</span>,
   <span class="hljs-attr">&quot;eventType&quot;</span>:<span class="hljs-string">&quot;incomingcall&quot;</span>,
   <span class="hljs-attr">&quot;callId&quot;</span>:<span class="hljs-string">&quot;c-m6dz5lqurhhxnn7is6v3w4y&quot;</span>,
   <span class="hljs-attr">&quot;callUri&quot;</span>: <span class="hljs-string">&quot;https://api.catapult.inetwork.com/v1/users/{user-id} /calls/{call-id}&quot;</span>
}
</code></pre>
</div></div></div>

<div class="api-method"><div class="api-method-definition"><div class="api-definition-top"></div><h3 id="step-2-create-a-new-outbound-call-to-the-pstn">Step 2: Create a New Outbound Call to the PSTN</h3>
<p><strong>Create a New Outbound Call to the PSTN</strong>. You can start a new outbound call to your SIP endpoint, <strong>be sure to set the callbackUrl so you can detect the &#x2018;answer&#x2019; event for the next step.</strong></p>
<p><code class="post">POST</code><code>/v1/users/{user-id}/calls</code></p>
</div><div class="api-method-code mm-method-code"><div class="api-method-example"><h3 id="create-a-new-outbound-call-to-the-pstn">Create a New Outbound Call to the PSTN</h3>
</div><div class="api-method-sample" data-lang="http" data-name="HTTP"><pre><code class="lang-json">{
&#x2002; <span class="hljs-attr">&quot;from&quot;</span>: <span class="hljs-string">&quot;+1555444333&quot;</span>,
&#x2002; <span class="hljs-attr">&quot;to&quot;</span>: <span class="hljs-string">&quot;sip:jsmith_mobile@xyz-corp-testing.bwapp.bwsip.io&quot;</span>,
  <span class="hljs-attr">&quot;callbackUrl&quot;</span> : <span class="hljs-string">&quot;http://yourserver.com&quot;</span>
}
</code></pre>
<pre><code>HTTP/1.1 201 Created
Location: /v1/users/{userId}/calls/{callId}
</code></pre></div></div></div>

<div class="api-method"><div class="api-method-definition"><div class="api-definition-top"></div><h3 id="step-3-receive-an-answer-event-from-bandwidth">Step 3: Receive an &#x2018;answer&#x2019; event from Bandwidth</h3>
<p><strong>Outbound SIP call - receive an &#x2018;answer&#x2019; event from Bandwidth</strong>. When the call answers the call, Bandwidth will POST to your callback URL the <a href="http://dev.bandwidth.com/ap-docs/apiCallbacks/answer.html" target="_blank"><code>answer</code></a> event that you will use to trigger answering the PSTN call leg and bridging the calls together.</p>
<p><code class="post">POST</code> <a href="http://yourwebserver.com" target="_blank">http://yourwebserver.com</a></p>
</div><div class="api-method-code mm-method-code"><div class="api-method-example"><h3 id="receive-an-answer-event-from-bandwidth">Receive an &#x2018;answer&#x2019; event from Bandwidth</h3>
</div><div class="api-method-sample" data-lang="http" data-name="HTTP"><pre><code class="lang-json">{
   <span class="hljs-attr">&quot;callState&quot;</span>:<span class="hljs-string">&quot;active&quot;</span>,
&#x2002;  <span class="hljs-attr">&quot;from&quot;</span>: <span class="hljs-string">&quot;+1555444333&quot;</span>,
&#x2002;  <span class="hljs-attr">&quot;to&quot;</span>: <span class="hljs-string">&quot;sip:jsmith_mobile@xyz-corp-testing.bwapp.bwsip.io&quot;</span>,
   <span class="hljs-attr">&quot;time&quot;</span>:<span class="hljs-string">&quot;2014-06-13T22:37:05Z&quot;</span>,
   <span class="hljs-attr">&quot;eventType&quot;</span>:<span class="hljs-string">&quot;answer&quot;</span>,
   <span class="hljs-attr">&quot;callId&quot;</span>:<span class="hljs-string">&quot;c-m6dz5lqurhhxnn7is6v3w4y&quot;</span>,
   <span class="hljs-attr">&quot;callUri&quot;</span>: <span class="hljs-string">&quot;https://api.catapult.inetwork.com/v1/users/{user-id} /calls/{call-id}&quot;</span>
}
</code></pre>
</div><div class="api-method-example"><p><strong>Answer the call.</strong></p>
</div><div class="api-method-sample" data-lang="http" data-name="HTTP"><p><code class="post">POST</code>/v1/users/{user-id}/calls/{call-id}</p>
<pre><code class="lang-json">{
   <span class="hljs-attr">&quot;state&quot;</span>: <span class="hljs-string">&quot;active&quot;</span>
}
</code></pre>
<pre><code>200 OK
</code></pre></div><div class="api-method-example"><p><strong>Bridge calls together.</strong></p>
</div><div class="api-method-sample" data-lang="http" data-name="HTTP"><p><code class="post">POST</code>/v1/users/{userId}/bridges</p>
<pre><code class="lang-json">{
  <span class="hljs-attr">&quot;callIds&quot;</span>:  [<span class="hljs-string">&quot;{callId1}&quot;</span>,<span class="hljs-string">&quot;{callId2}&quot;</span>]
}
</code></pre>
<pre><code>HTTP/1.1 201 Created
Location: /v1/users/{userId}/calls/{bridgeId}
</code></pre></div></div></div>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class="search-results-count"></span> results matching &quot;<span class="search-query"></span>&quot;</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching &quot;<span class="search-query"></span>&quot;</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            

        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Configure SIP","level":"2.10","depth":1,"next":{"title":"WebRTC","level":"2.11","depth":1,"path":"howto/webrtc.md","ref":"howto/webrtc.md","articles":[]},"previous":{"title":"For Mobile Apps","level":"2.9","depth":1,"path":"howto/acrobits.md","ref":"howto/acrobits.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["theme-bandwidth","header","sharing","custom-favicon","toggle-chapters","customJquery@git+https://github.com/dtolb/gitbook-plugin-customJquery.git","gtm","crazyegg","usabilla","-fontsettings","bandwidth-fonts","-highlight","bandwidth-highlight"],"pluginsConfig":{"gtm":{"token":"GTM-P2JT7Z","virtualPageViews":true},"search":{},"bandwidth-fonts":{"family":"sans","size":2,"theme":"white"},"layout":{"headerPath":"layouts/header.html"},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"theme-bandwidth":{"languages":[{"lang":"js","name":"Js","default":true},{"lang":"csharp","name":"C#"},{"lang":"ruby","name":"ruby"},{"lang":"shell","name":"cURL"},{"lang":"bash","name":"cURL"}],"split":true,"theme":"light"},"header":{},"customJquery":{"js":"js/custom.js"},"fontsettings":{"theme":"white","family":"sans","size":2},"crazyegg":{"partOne":"0029","partTwo":"8291"},"favicon":"images/favicon.ico","usabilla":{"usabillaId":"73009503da29"},"bandwidth-highlight":{},"custom-favicon":{},"sharing":{"all":["facebook","google","twitter","weibo","instapaper"],"facebook":false,"google":false,"instapaper":false,"twitter":false,"vk":false,"weibo":false},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"toggle-chapters":{}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"howto/sip.md","mtime":"2017-04-05T19:20:12.155Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2017-04-05T19:21:37.926Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

	<!-- begin usabilla live embed code -->
	<script type="text/javascript">/*{literal}<![CDATA[*/window.lightningjs||function(c){function g(b,d){d&&(d+=(/\?/.test(d)?"&":"?")+"lv=1");c[b]||function(){var i=window,h=document,j=b,g=h.location.protocol,l="load",k=0;(function(){function b(){a.P(l);a.w=1;c[j]("_load")}c[j]=function(){function m(){m.id=e;return c[j].apply(m,arguments)}var b,e=++k;b=this&&this!=i?this.id||0:0;(a.s=a.s||[]).push([e,b,arguments]);m.then=function(b,c,h){var d=a.fh[e]=a.fh[e]||[],j=a.eh[e]=a.eh[e]||[],f=a.ph[e]=a.ph[e]||[];b&&d.push(b);c&&j.push(c);h&&f.push(h);return m};return m};var a=c[j]._={};a.fh={};a.eh={};a.ph={};a.l=d?d.replace(/^\/\//,(g=="https:"?g:"http:")+"//"):d;a.p={0:+new Date};a.P=function(b){a.p[b]=new Date-a.p[0]};a.w&&b();i.addEventListener?i.addEventListener(l,b,!1):i.attachEvent("on"+l,b);var q=function(){function b(){return["<head></head><",c,' onload="var d=',n,";d.getElementsByTagName('head')[0].",d,"(d.",g,"('script')).",i,"='",a.l,"'\"></",c,">"].join("")}var c="body",e=h[c];if(!e)return setTimeout(q,100);a.P(1);var d="appendChild",g="createElement",i="src",k=h[g]("div"),l=k[d](h[g]("div")),f=h[g]("iframe"),n="document",p;k.style.display="none";e.insertBefore(k,e.firstChild).id=o+"-"+j;f.frameBorder="0";f.id=o+"-frame-"+j;/MSIE[ ]+6/.test(navigator.userAgent)&&(f[i]="javascript:false");f.allowTransparency="true";l[d](f);try{f.contentWindow[n].open()}catch(s){a.domain=h.domain,p="javascript:var d="+n+".open();d.domain='"+h.domain+"';",f[i]=p+"void(0);"}try{var r=f.contentWindow[n];r.write(b());r.close()}catch(t){f[i]=p+'d.write("'+b().replace(/"/g,String.fromCharCode(92)+'"')+'");d.close();'}a.P(2)};a.l&&setTimeout(q,0)})()}();c[b].lv="1";return c[b]}var o="lightningjs",k=window[o]=g(o);k.require=g;k.modules=c}({});
	window.usabilla_live = lightningjs.require("usabilla_live", "//w.usabilla.com/73009503da29.js");
	/*]]>{/literal}*/</script>
	<!-- end usabilla live embed code -->


        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-toggle-chapters/toggle.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-gtm/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-bandwidth-fonts/fontsettings.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-theme-bandwidth/theme-api.js"></script>
        
    

    </body>
</html>

